#!/usr/bin/ansible-playbook -i beaker,
# vi: ft=yaml:

# Install multiple packages I normally need for working on bugs, it also
# installs upstream go so I can verify against different compiler versions

---
- hosts: beaker
  tasks:
    - name: "Install packages"
      dnf:
        name:
          - '@Development tools'
          - '@RPM Development Tools'
          - git
          - rsync
          - tmux
          - jq
          - go-toolset
          - lsof
        state: present

    - name: "Check if upstream go is installed"
      command: gotip version
      register: gotip_version_output
      changed_when: false
      ignore_errors: true

    - name: "Set fact if upstream go is already installed"
      set_fact:
        upstream_go_installed: true
      when: gotip_version_output.rc == 0

    - name: "Install upstream go"
      block:
        - command: go install golang.org/dl/gotip@latest
        - command: gotip download release-branch.go1.20
      when: upstream_go_installed is not defined

